<turbo-frame id="console-turbo-frame">


  <style>
    .hero .console {
      position: absolute;
      right: 0;
      bottom: 0;
      /* 控制台宽高 */
      width: 759px;

      /* transform: scale(0.9); */
      display: flex;
      justify-content: flex-end;
      align-items: flex-end;
      /* background-color: gray; */
    }


    .hero .info {
      position: absolute;
      right: calc(675px * 0.7);
      bottom: calc(500px * 0.7);
      width: calc(1094px * 0.7);
      color: white;
      font-size: calc(22px * 0.7);
      line-height: 1.2em;
      pointer-events: none;
      opacity: 0;
    }

    .hero .info p {
      height: 1em;
    }

    .hero .info.active {
      opacity: 1;
    }

    .hero .console-info {
      position: absolute;
      right: calc(278px * 0.7);
      bottom: calc(270px * 0.7);
      width: calc(515px * 0.7);
      color: white;
      font-size: calc(22px * 0.7);
      line-height: 1.2em;
      ;
      background-color: #0d1b26;
      border: 2px solid #d2c075;
      border-radius: 5px;
      line-break: anywhere;
      padding: 10px;
      opacity: 1;
      visibility: hidden;
    }

    .hero .console-info p {
      min-height: 16px;
      /* word-wrap: break-word; */
    }

    .hero .console-info p:first-child {
      margin-bottom: 8px;
    }

    .hero .console-info.active {
      opacity: 1;
    }


    .hero .console-item {
      width: calc(159px * .7);
      display: flex;
      flex-wrap: wrap;
      align-content: flex-end;
      justify-content: flex-end;
      /* background-color: #ccffff; */
    }

    .hero .console-item div[class^="console-item"] {
      width: calc(60px * .7);
      height: calc(59px * .7);
      /* background-color: #ccffff; */
      margin: 3px 4px;
    }

    .hero .console-item div[class^="console-item-"]:hover .console-info {
      visibility: visible;
    }

    .hero .console-ability {
      width: calc(375px * 0.7);
      display: flex;
      flex-wrap: wrap;
      margin-right: calc(256px * 0.7);
      justify-content: flex-end;
      align-content: flex-end;
      /* background-color: red; */
    }

    .hero .console-ability div[class^="console-ability-"] {
      width: calc(75px * .7);
      height: calc(75px * .7);
      /* background-color: #ccffff; */
      margin: 1px calc(1.6px * .7);
    }

    .hero .console-ability div[class^="console-ability-"]:hover .console-info {
      visibility: visible;
    }

    .hero .console .console-ability a:before {
      content: '';
      display: block;
      height: 100%;
    }
  </style>
  <div class="info">
  </div>
  <div class="console-item">
    <div class="console-item-1">
      <!-- <div class="console-info">
        <p><span style="color:#ccffff">类型：</span><span style="color:#ffcc99">物理伤害、分身<span></p>
          <p><span style="color:#ccffff">属性：</span><span style="color:#ffcc99">攻击力</span></p>
          <br>
          <p><span style="color:#ccffff">红翼天使在附近敌人身上创造</span><span style="color:#ffce00">分身</span><span style="color:#ccffff">进行攻击，分身拥有本体</span><span style="color:#ffce00">78%攻击力，</span><span style="color:#ccffff">额外</span><span style="color:#ffce00">60%攻击速度，</span><span style="color:#ccffff">且无法控制，但也不会受到伤害。最多制造</span><span style="color:#ffcc00">2个</span><span style="color:#ccffff">分身</span></p>
          <p><span style="color:#ffce00">持续5秒<span></p>
      </div> -->
    </div>
    <div class="console-item-2">
    </div>
    <div class="console-item-3">
    </div>
    <div class="console-item-4">
    </div>
    <div class="console-item-5">
    </div>
    <div class="console-item-6">
    </div>
  </div>
  <div class="console-ability">
    <div class="console-ability-1">
    </div>
    <div class="console-ability-2">
    </div>
    <div class="console-ability-3">
    </div>
    <div class="console-ability-4">
    </div>
    <div class="console-ability-5">
    </div>
    <div class="console-ability-6">
    </div>
    <div class="console-ability-7">
    </div>
    <div class="console-ability-8">
    </div>
    <div class="console-ability-9">
    </div>
    <div class="console-ability-10">
    </div>
    <div class="console-ability-11">
    </div>
    <div class="console-ability-12">
    </div>
  </div>
  <script>
    (function () {
      // 获取URL中的锚点
      const hash = window._self.type;
      if (hash === "#mp") {
        var datajs = "/mp/mp-data.js"
        var dataImg = "/mp/mp-imgs"
        var data = mpdata
      } else {
        var datajs = "/x7/x7-data.js"
        var dataImg = "/x7/x7-imgs"
        var data = x7data
      }
      class Dom {
        constructor() {
          this.hero = document.querySelector(".hero")
          this.heroul = document.querySelector(".hero ul")
          this.consoleAbility = document.querySelector(".hero .console .console-ability")
        }
        get info() {
          return document.querySelector(".hero .info")
        }
      }
      var dom = new Dom()

      console.log("加载完成" + window._self.dataHeroId)
      console.log(data[window._self.dataHeroId])
      const hero = data[window._self.dataHeroId]

      if (hero.intro !== null && hero.intro !== undefined) {
        dom.info.innerHTML = formatHtmlString(hero.intro)
        dom.info.classList.add('active')
      }

      addPifu(dom.consoleAbility.children[0], hero.p1)
      addPifu(dom.consoleAbility.children[1], hero.p2)
      // 梦的第2排技能
      addAbility(dom.consoleAbility.children[4], hero.core)
      addAbility(dom.consoleAbility.children[5], hero.d2)
      addAbility(dom.consoleAbility.children[7], hero.t2)

      // x7的第2排技能
      addAbility(dom.consoleAbility.children[6], hero.t)
      addAbility(dom.consoleAbility.children[7], hero.d)

      addAbility(dom.consoleAbility.children[8], hero.q)
      addAbility(dom.consoleAbility.children[9], hero.w)
      addAbility(dom.consoleAbility.children[10], hero.e)
      addAbility(dom.consoleAbility.children[11], hero.r)

      function addAbility(ele, viewData) {
        if (viewData) {
          ele.style = `background:url("${dataImg}/${viewData.icon}") no-repeat center center / contain;`
          ele.innerHTML = `<div class="console-info">${formatHtmlString(viewData.desc)}</div>`
        }
      }
      function addPifu(ele, viewData) {
        if (viewData) {
          ele.innerHTML = `<a href="/bilibili/hero/hero-console.html" data-hero-id="${viewData.unitId}" data-turbo-frame="console-turbo-frame"></a><div class="console-info">${formatHtmlString(viewData.desc)}</div>`
          ele.style = `background:url("${dataImg}/${viewData.icon}") no-repeat center center / contain;`
        }
      }

      function formatHtmlString(desc) {
        let strs = desc.split("|n")
        var obj = {
          str: '',
          buf: '',
          lastColor: '|cfffff'
        }
        for (const p of strs) {
          obj.str = p
          obj = handle(obj)
        }
        return obj.buf
      }


      function handle({ str, buf, lastColor }) {

        str = str.replaceAll("/\|r\|cff/gi", "|cff")
        str = str.replaceAll("|r", "|cfffff")

        if (!str.startsWith("|cff")) {
          str = lastColor + str
        }

        buf += "<p>"

        const pat = /(\|cff(\w{3,6}))(.*?)(?=((\|cff)|$))/gi
        const mat = str.matchAll(pat)
        for (const match of mat) {
          lastColor = match[1]
          const color = match[2]
          const text = match[3]
          buf += `<span style="color:#${color}">${text}</span>`
        }

        buf += "</p>"
        return { str, buf, lastColor }
      }

    })()

  </script>

</turbo-frame>