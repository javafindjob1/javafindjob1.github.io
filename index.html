<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>游戏攻略</title>
  <link rel="stylesheet" href="./css/reset.css">
  <!-- <script defer src="./js/turbo.es2017-umd.min.js"></script> -->
  <script defer src="https://unpkg.com/@hotwired/turbo@8.0.12/dist/turbo.es2017-umd.js"></script>
  <script defer src="./js/common.js"></script>
  <link rel="favicon icon" href="./bilibili/asset/favicon.ico">
  <link rel="stylesheet" href="./bilibili/asset/index-flex.css">
  <link rel="stylesheet" href="./kk/font/a0.font.7ad948.css" media="none" onload="this.media='all'">
  <!-- <link rel="preload" as="script" href="./mp/mp-data.js">
  <link rel="preload" as="script" href="./x7/x7-data.js"> -->
</head>

<body>
  <div id="app">
    <header class="page-header clearfix">
      <div class="type leftfix">
        <img src1="./bilibili/asset/logo.webp" alt="">
      </div>
      <ul class="menu rightfix clearfix">
        <li>
          <a href="./bilibili/live/live.html" data-turbo-frame="repo-content-turbo-frame"
            data-view-component="true">主播</a>
        </li>
        <!-- <li><a href="/bilibili/item/item.html" data-turbo-frame="repo-content-turbo-frame"
            data-view-component="true">装备列表</a></li> -->
        <li><a href="./bilibili/hero/hero-list.html" data-turbo-frame="repo-content-turbo-frame"
            data-view-component="true">英雄列表</a></li>
        <li><a href="./bilibili/about/about.html" data-turbo-frame="repo-content-turbo-frame"
            data-view-component="true">关于</a></li>
      </ul>

      <div class="subnav">
        <ul>
          <li><a href="#x7" data-img="./bilibili/header/西7.webp" data-turbo="false">西方世界的劫难7</a></li>
          <li><a href="#mp" data-img="./bilibili/header/mp.webp" data-turbo="false">梦想愿景</a></li>
        </ul>
      </div>
    </header>

    <script>

      (function () {

        var dom = {
          type: document.querySelector(".page-header .type img"),
          menu: document.querySelector(".page-header ul.menu"),
          menua: document.querySelectorAll(".page-header ul.menu a"),
          subnav: document.querySelector(".page-header .subnav"),
          subnava: document.querySelectorAll(".page-header .subnav a"),
        }

        dom.menu.addEventListener('click', e => {
          e.target.tagName == 'A' && changeIframeSrc(e.target)
        })

        function changeIframeSrc(img) {
          dom.menua.forEach(function (v) {
            v.classList.remove('active')
          })
          img.classList.add('active')
        }

        // 游戏分类
        let preSrc = dom.type.src;
        dom.subnav.addEventListener('click', e => {
          if (e.target.tagName == 'A') {
            preSrc = e.target.getAttribute('data-img')
            recordAnchor(e)
            dom.subnava.forEach(function (v) {
              v.classList.remove('active')
            })
            e.target.classList.add('active')

          }
        })

        dom.subnav.addEventListener('mouseover', e => {
          e.target.tagName == 'A' && changeSubnavSrc(e.target.getAttribute('data-img'))
        })
        dom.subnav.addEventListener('mouseout', e => {
          e.target.tagName == 'A' && changeSubnavSrc(preSrc)
        })

        function initMenu() {
          // 创建一个新的点击事件
          const clickEvent = new MouseEvent('click', {
            view: window,
            bubbles: true,
            cancelable: true
          });
          // 触发点击事件
          document.querySelector(".page-header ul.menu li:nth-child(2) a").dispatchEvent(clickEvent);
        }

        function changeSubnavSrc(v) {
          dom.type.src = v;
        }
        
        /**
          * 记录锚点供其他页面识别游戏类别
          */
        function recordAnchor(e) {
          window._self = window._self || {}
          if (e) {
            window._self.type = e.target.getAttribute('href')
            changeSubnavSrc(e.target.getAttribute('data-img'))

          } else {
            // 获取URL中的锚点
            let hash = window.location.hash
            if (hash === '#' || hash === '') {
              hash = '#x7'
            }
            window._self.type = hash
            const src = dom.subnav.querySelector(`a[href="${hash}"]`).getAttribute('data-img')
            preSrc = src
            changeSubnavSrc(src)
          }

          initMenu()
        }

        document.addEventListener("turbo:load", function () {
          console.log("turbo:load event");
          recordAnchor && recordAnchor()
        });
        document.addEventListener("turbo:before-visit", function () {
          console.log("turbo:before-visit event");
        });
        document.addEventListener("turbo:before-fetch-request", function () {
          console.log("turbo:before-fetch-request event");
        });
        document.addEventListener("turbo:before-render", function () {
          console.log("turbo:before-render event");
        });
        document.addEventListener("turbo:render", function () {
          console.log("turbo:render event");
        });

      })()

    </script>

    <turbo-frame id="repo-content-turbo-frame" src1="/bilibili/hero/hero-list.html">
      <p>加载中...</p>
    </turbo-frame>

    <footer>
      <span>© 技术支持 Email： java_findjob@163.com</span>
      <!-- <span> © 网站备案号： 鲁ICP备20016477号-1</span> -->
    </footer>

  </div>
  <script src="/mp/mp-data.js" defer></script>
  <script src="/x7/x7-data.js" defer></script>
  <script src="/x7/x7-skin.js" defer></script>
  <script src="/mp/mp-skin.js" defer></script>
</body>

</html>